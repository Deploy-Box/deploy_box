<!-- Sidebar -->
<div id="sidebar" class="fixed top-0 left-0 z-40 h-screen bg-white shadow-lg transition-all duration-300 ease-in-out"
    data-expanded="false">
    <div class="flex flex-col h-full">
        <div class="p-4 border-b flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="https://avatars.githubusercontent.com/u/205388835?s=200&v=4" alt="Deploy Box Logo"
                    class="w-8 h-8 rounded-full">
                <h2 class="text-xl font-bold sidebar-text">Deploy Box</h2>
            </div>
        </div>
        <nav class="flex-1 overflow-y-auto py-4">
            <ul class="space-y-1 px-3">
                <!-- Organization Section -->
                <li class="mb-4">
                    <a class="flex items-center gap-3 p-3 sidebar-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Zm0 3h.008v.008h-.008v-.008Z" />
                        </svg>
                        <span class="sidebar-text font-semibold">Organization</span>
                    </a>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Org
                            Overview</a>
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Members</a>
                    </div>
                </li>

                <div class="border-b border-gray-200 my-4"></div>

                <!-- Project Section -->
                <li class="mb-4">
                    <div class="flex items-center gap-3 p-3 sidebar-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                        </svg>
                        <span class="sidebar-text font-semibold">Project</span>
                    </div>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Project
                            Overview</a>
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Settings</a>
                    </div>
                </li>

                <div class="border-b border-gray-200 my-4"></div>

                <!-- Stack Section -->
                <li class="mb-4">
                    <div class="flex items-center gap-3 p-3 sidebar-button">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="size-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M6.429 9.75 2.25 12l4.179 2.25m0-4.5 5.571 3 5.571-3m-11.142 0L2.25 7.5 12 2.25l9.75 5.25-4.179 2.25m0 0L21.75 12l-4.179 2.25m0 0 4.179 2.25L12 21.75 2.25 16.5l4.179-2.25m11.142 0-5.571 3-5.571-3" />
                        </svg>
                        <span class="sidebar-text font-semibold">Stack</span>
                    </div>
                    <div class="ml-8 mt-2 space-y-1">
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Profile</a>
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Security</a>
                        <a href="#"
                            class="block p-2 hover:text-primary-600 transition-colors duration-200 sidebar-text sidebar-button">Preferences</a>
                    </div>
                </li>
            </ul>
        </nav>
        <a href="{% url 'main_site:profile' %}" class="p-4 border-t relative sidebar-button">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 rounded-full bg-primary-100 flex items-center justify-center">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="size-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    </svg>

                </div>
                <div class="sidebar-text">
                    <p class="font-medium">Admin</p>
                    <p class="text-sm text-gray-500">Administrator</p>
                </div>
            </div>
        </a>
    </div>
</div>

<!-- Overlay for mobile -->
<div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

<style>
    #sidebar[data-expanded="false"] {
        width: 5rem;
    }

    #sidebar[data-expanded="true"] {
        width: 16rem;
    }

    #sidebar[data-expanded="false"] .sidebar-text {
        display: none;
    }

    /* Add smooth transitions for all properties */
    #sidebar {
        transition: width 0.3s ease-in-out;
    }

    /* Prevent text wrapping and ensure consistent height */
    .sidebar-text {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        min-height: 1.5em;
        display: block;
    }

    /* Ensure consistent height for menu items */
    .flex.items-center.gap-3 {
        min-height: 2.5rem;
    }

    /* Ensure consistent spacing for nested items */
    .ml-8.mt-2.space-y-1 {
        min-height: 2rem;
    }

    #sidebarToggle {
        position: absolute;
        bottom: 1rem;
        right: 1rem;
        z-index: 50;
    }

    @media (max-width: 768px) {
        #sidebar[data-expanded="true"] {
            width: 16rem;
            position: absolute;
            z-index: 40;
            height: 100%;
        }

        #sidebar[data-expanded="false"] {
            width: 0;
            overflow: hidden;
        }
    }

    /* Sidebar button hover animation */
    .sidebar-button,
    .sidebar-link {
        transition: background 0.2s, transform 0.15s;
        border-radius: 0.5rem;
    }

    .sidebar-button:hover,
    .sidebar-link:hover {
        background: #f3f4f6;
        /* Tailwind gray-100 */
        transform: scale(1.03);
        box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.04);
    }
</style>

<!-- JavaScript for sidebar functionality -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Cookie utility functions
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        const sidebar = document.getElementById('sidebar');
        let isExpanded = sidebar.getAttribute('data-expanded') === 'true';
        let hoverTimeout = null;
        let tempExpanded = false;

        // On load, check cookie for sidebar state
        let cookieState = getCookie('sidebarExpanded');
        if (cookieState !== null) {
            isExpanded = cookieState === 'true';
            sidebar.setAttribute('data-expanded', isExpanded);
        } else {
            isExpanded = false;
            sidebar.setAttribute('data-expanded', 'false');
        }


        function toggleSidebar() {
            isExpanded = !isExpanded;
            sidebar.setAttribute('data-expanded', isExpanded);
            setCookie('sidebarExpanded', isExpanded, 30); // Store for 30 days
        }


        // Handle responsive behavior
        function handleResize() {
            if (window.innerWidth < 768) {
                sidebar.setAttribute('data-expanded', 'false');
                isExpanded = false;
            } else {
                // Keep collapsed by default on desktop
                sidebar.setAttribute('data-expanded', 'false');
                isExpanded = false;
            }
            setCookie('sidebarExpanded', isExpanded, 30);
        }

        window.addEventListener('resize', handleResize);
        handleResize(); // Initial check

        // Hover to temporarily expand sidebar
        sidebar.addEventListener('mouseenter', function () {
            if (!isExpanded) {
                hoverTimeout = setTimeout(() => {
                    sidebar.setAttribute('data-expanded', 'true');
                    tempExpanded = true;
                }, 200); // 0.45 seconds
            }
        });

        sidebar.addEventListener('mouseleave', function () {
            clearTimeout(hoverTimeout);
            if (tempExpanded) {
                sidebar.setAttribute('data-expanded', 'false');
                tempExpanded = false;
            }
        });
    });
</script>