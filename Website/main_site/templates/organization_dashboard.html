{% extends 'base.html' %} {%load static%} {% block content %}
<div class="min-h-full pb-12">
  <div class="w-full bg-zinc-950 pt-16 pb-24 text-center">
    <h4 class="text-2xl text-gray-100 mt-10">Organization Dashboard</h4>
    <p class="text-md text-gray-100 mt-2">Manage your organizations</p>
  </div>

  <div
    class="w-full 2xl:w-3/4 flex items-center justify-center px-8 md:px-32 lg:px-16 2xl:px-0 mx-auto -mt-10"
  >
    <div class="w-full max-w-4xl">
      <!-- Organization Details Section -->
      <div class="bg-white shadow-2xl rounded-lg py-8 px-8 mb-8">
        <h2 class="text-xl font-bold text-emerald-400 mb-6">
          Organization Details
        </h2>
        <div id="organizationDetails" class="space-y-4">
          <!-- Organization details will be loaded here dynamically -->
          <div class="bg-zinc-50 p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold text-zinc-900">
                  {{organization.name}}
                </h3>
                <p class="text-sm text-zinc-500">
                  Created: {{organization.created_at}}
                </p>
                <p class="text-sm text-zinc-500">ID: {{organization.id}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Projects Section -->
      <div class="bg-white shadow-2xl rounded-lg py-8 px-8 mb-8">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold text-emerald-400">Projects</h2>
          <a href="{% url 'main_site:create_project_form' organization_id=organization.id %}">
            <button class="bg-emerald-400 hover:bg-emerald-500 px-4 py-2 text-sm text-white uppercase rounded font-bold transition duration-150">
              Create Project
            </button>
          </a>
        </div>
        <div id="projectsList" class="space-y-4">
          {% for project in projects %}
          <div class="bg-zinc-50 p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold text-zinc-900">{{ project.name }}</h3>
                <p class="text-sm text-zinc-500">Created: {{ project.created_at }}</p>
              </div>
              <div class="space-x-2">
                <a href="{% url 'main_site:project_dashboard' project.organization_id project.id %}" class="flex-1 bg-zinc-100 hover:bg-zinc-200 px-8 py-2 text-sm text-zinc-900 uppercase rounded transition duration-150 text-center">
                  Manage Project
                </a>
                <button id="deleteProjBtn" class="text-red-500 hover:text-red-600" value="{{project.id}}">
                  Delete
                </button>
              </div>
            </div>
          </div>
          {% empty %}
          <div>No projects in this organization</div>
          {% endfor %}
        </div>
      </div>

      <!-- Organization Members Section -->
      <div class="bg-white shadow-2xl rounded-lg py-8 px-8 mb-8">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-xl font-bold text-emerald-400">
            Organization Members
          </h2>
          <a href="{% url 'main_site:add_org_members' organization_id=organization.id %}">
            <button
              id="inviteMemberBtn"
              class="bg-emerald-400 hover:bg-emerald-500 px-4 py-2 text-sm text-white uppercase rounded font-bold transition duration-150"
            >
              Invite Member
            </button>
          </a>
        </div>
        <div id="membersList" class="space-y-4">
          <!-- Members will be loaded here dynamically -->
          {% for member in members %}
          <div class="bg-zinc-50 p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <h3 class="text-lg font-semibold text-zinc-900">
                  {{member.user.username}}
                </h3>
                <p class="text-sm text-zinc-500">Role: {{member.role|title}}</p>
              </div>
              <div class="space-x-2">
                <button id="memberRole" class="text-emerald-400 hover:text-emerald-500" value="{{member.role.lower}}" user_id="{{member.user.id}}">
                  {% if member.role.lower == 'member' %}Make Admin{% else %}Make Member{% endif %}
                </button>
                <button class="text-red-500 hover:text-red-600">Delete</button>
              </div>
            </div>
          </div>
          {% empty %}
          <div>This organization has no members</div>
          {% endfor %}
        </div>
      </div>

      <!-- Billing Section -->
      <div class="bg-white shadow-2xl rounded-lg py-8 px-8 mb-8">
        <h2 class="text-xl font-bold text-emerald-400 mb-6">Billing</h2>
        <div class="space-y-6">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-zinc-900">Current Plan</h3>
              <p class="text-sm text-zinc-500">View your current subscription plan</p>
            </div>
            <button
              id="viewPlanBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150"
            >
              View Plan
            </button>
          </div>
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-zinc-900">Billing History</h3>
              <p class="text-sm text-zinc-500">View your past invoices and payments</p>
            </div>
            <button
              id="viewBillingHistoryBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150"
            >
              View History
            </button>
          </div>
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-zinc-900">Payment Method</h3>
              <p class="text-sm text-zinc-500">Add or update your payment method</p>
            </div>
            <button
              id="addPaymentMethodBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150"
            >
              Add Payment Method
            </button>
          </div>

          <!-- Current Card Information -->
          <div id="currentCardInfo" class="hidden bg-zinc-50 p-4 rounded-lg">
            <div class="flex justify-between items-center">
              <div>
                <h4 class="text-md font-semibold text-zinc-900">Current Card</h4>
                <p class="text-sm text-zinc-500">
                  <span id="cardBrand"></span> ending in <span id="cardLast4"></span>
                </p>
                <p class="text-sm text-zinc-500">
                  Expires <span id="cardExpMonth"></span>/<span id="cardExpYear"></span>
                </p>
              </div>
              <button
                id="removeCardBtn"
                class="text-red-500 hover:text-red-600 text-sm font-medium"
              >
                Remove Card
              </button>
            </div>
          </div>

          <!-- Stripe Elements Container -->
          <div id="paymentForm" class="hidden mt-4">
            <form id="stripePaymentForm">
              <div
                id="cardElement"
                class="bg-zinc-50 p-4 rounded-lg border border-zinc-200"
              ></div>
              <div id="cardErrors" class="text-red-500 text-sm mt-2"></div>
              <button
                type="submit"
                class="bg-emerald-400 hover:bg-emerald-500 px-4 py-2 text-sm text-white uppercase rounded font-bold transition duration-150 mt-4"
              >
                Save Payment Method
              </button>
            </form>
          </div>
        </div>
      </div>

      <!-- Organization Settings -->
      <div class="bg-white shadow-2xl rounded-lg py-8 px-8">
        <h2 class="text-xl font-bold text-emerald-400 mb-6">
          Organization Settings
        </h2>
        <div class="space-y-6">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-zinc-900">
                Organization Name
              </h3>
              <p class="text-sm text-zinc-500">
                Change your organization's display name
              </p>
            </div>
            <button
              id="editNameBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150"
            >
              Edit Name
            </button>
          </div>
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-zinc-900">API Keys</h3>
              <p class="text-sm text-zinc-500">
                Manage your organization's API keys
              </p>
            </div>
            <button
              id="manageApiKeysBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150"
            >
              Manage Keys
            </button>
          </div>
          <div class="flex justify-between items-center {% if not is_admin %}opacity-75{% endif %}">
            <div>
              <h3 class="text-lg font-semibold {% if not is_admin %}text-zinc-500{% else %}text-red-600{% endif %}">
                Delete Organization
              </h3>
              <p class="text-sm text-zinc-500">
                Permanently delete this organization and all its data
              </p>
            </div>
            <button
              id="deleteOrgBtn"
              class="bg-zinc-100 hover:bg-zinc-200 px-6 py-3 text-sm text-zinc-900 rounded font-bold transition duration-150 {% if not is_admin %}bg-red-100 hover:bg-red-100 cursor-not-allowed{% endif %}"
              {% if not is_admin %}disabled title="Only organization admins can delete the organization"{% endif %}
            >
              Delete Organization
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Hidden input for organization ID -->
<input type="hidden" id="organizationId" value="{{ organization.id }}">
<script src="https://js.stripe.com/v3/"></script>
<script src="{% static 'organization_dashboard.js' %}"></script>

{% endblock %}
