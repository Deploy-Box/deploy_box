<script src="https://js.stripe.com/v3/"></script>

<!-- Payment Form -->
<form id="payment-form">
  <div id="card-element">
    <!-- Stripe Element will be inserted here -->
  </div>
  <button type="submit" id="submit">Submit Payment</button>
</form>

<script>
  var stripe = Stripe(
    "pk_test_51R0cehC8awKXIVJajHxovZ30vdMGKtaCMM5I5YcE4L2YjEqrAeISrU2gDmYeun8nz0rzIQYYPbKjQOBzyGuw5zkZ00FyYoTQrE"
  ); // Your Stripe publishable key
  var elements = stripe.elements();

  // Create an instance of the card Element.
  var cardElement = elements.create("card", {
    style: {
      base: {
        color: "#32325d",
        fontFamily: "Arial, sans-serif",
        fontSize: "16px",
        fontSmoothing: "antialiased",
        "::placeholder": {
          color: "#aab7c4",
        },
      },
      invalid: {
        color: "#fa755a",
        iconColor: "#fa755a",
      },
    },
  });

  // Mount the card Element to the DOM (in the div with id 'card-element').
  cardElement.mount("#card-element");

  // Form submission handler
  var form = document.getElementById("payment-form");

  form.addEventListener("submit", function (event) {
    event.preventDefault(); // Prevent form submission

    stripe
      .createPaymentMethod({
        type: "card",
        card: cardElement,
      })
      .then(function (result) {
        if (result.error) {
          // Handle errors (e.g., invalid card details)
          console.log(result.error.message);
        } else {
          // Send Payment Method ID to your Django backend
          fetch("/payments/create-payment-method/", {
            method: "POST",
            body: JSON.stringify({
              payment_method_id: result.paymentMethod.id,
            }),
            headers: { "Content-Type": "application/json" },
          })
            .then((response) => response.json())
            .then((data) => {
              console.log(data);
              // Create subscription with customer ID
              fetch("/payments/create-subscription/", {
                method: "POST",
                body: JSON.stringify({ customer_id: data.customer_id }),
                headers: { "Content-Type": "application/json" },
              })
                .then((response) => response.json())
                .then((subscriptionData) => {
                  // Handle success, such as redirecting to Stripe Checkout or displaying a success message
                  console.log("Subscription created:", subscriptionData);
                });
            });
        }
      });
  });
</script>
